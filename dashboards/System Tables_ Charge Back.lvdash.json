{"datasets":[{"name":"feb68fe4","displayName":"Creator Job Apportionment","query":"SELECT q_creator.job_run_creator, \n        round(min(q_all.total_cost),2) total_cluster_cost,\n       round(sum(q_creator.exec_duration_weighted_cluster_cost),2) creator_cost,\n       round(creator_cost/min(q_all.total_cost),2) pct_attribution\nFROM finops.system_lookups.v_job_creator_weighted_cost q_creator\n-- cartesian\nINNER JOIN (\n    SELECT sum(t.exec_duration_weighted_cluster_cost) total_cost\n    FROM finops.system_lookups.v_job_creator_weighted_cost t\n    WHERE t.usage_date BETWEEN :from_date AND :to_date\n) q_all \nWHERE q_creator.usage_date BETWEEN :from_date AND :to_date\nGROUP BY q_creator.job_run_creator\nORDER BY sum(q_creator.exec_duration_weighted_cluster_cost) DESC","parameters":[{"displayName":"from_date","keyword":"from_date","dataType":"DATE","defaultSelection":{"values":{"dataType":"DATE","values":[{"value":"2024-04-01T00:00:00.000"}]}}},{"displayName":"to_date","keyword":"to_date","dataType":"DATE","defaultSelection":{"values":{"dataType":"DATE","values":[{"value":"2024-05-01T00:00:00.000"}]}}}]},{"name":"b6379e69","displayName":"Creator Job by Month","query":"SELECT q_creator.job_run_creator, \n        q_creator.usage_date, \n        round(min(q_all.total_cost),2) total_cluster_cost,\n       round(sum(q_creator.exec_duration_weighted_cluster_cost),2) creator_cost,\n       round(creator_cost/min(q_all.total_cost),2) pct_attribution\nFROM finops.system_lookups.v_job_creator_weighted_cost q_creator\n-- cartesian\nINNER JOIN (\n    SELECT sum(t.exec_duration_weighted_cluster_cost) total_cost\n    FROM finops.system_lookups.v_job_creator_weighted_cost t\n    WHERE t.usage_date BETWEEN :from_date AND :to_date\n) q_all \nWHERE q_creator.usage_date BETWEEN :from_date AND :to_date\nGROUP BY q_creator.job_run_creator, q_creator.usage_date\nORDER BY sum(q_creator.exec_duration_weighted_cluster_cost) DESC","parameters":[{"displayName":"from_date","keyword":"from_date","dataType":"DATE","defaultSelection":{"values":{"dataType":"DATE","values":[{"value":"2024-04-01T00:00:00.000"}]}}},{"displayName":"to_date","keyword":"to_date","dataType":"DATE","defaultSelection":{"values":{"dataType":"DATE","values":[{"value":"2024-05-06T00:00:00.000"}]}}}]}],"pages":[{"name":"a5554b0d","displayName":"New Page","layout":[{"widget":{"name":"c466b0d7","textbox_spec":"This charge-back dashboard apportions spend by job run-time on cluster resources (shared or job-cluster compute).  Apportionment is grouped by the job_run creator_user_name.  This seems to align with job \"run_as.\""},"position":{"x":0,"y":0,"width":6,"height":1}},{"widget":{"name":"865e8a61","queries":[{"name":"main_query","query":{"datasetName":"b6379e69","fields":[{"name":"sum(creator_cost)","expression":"SUM(`creator_cost`)"},{"name":"monthly(usage_date)","expression":"DATE_TRUNC(\"MONTH\", `usage_date`)"},{"name":"job_run_creator","expression":"`job_run_creator`"}],"disaggregated":false,"orders":[{"direction":"ASC","expression":"`job_run_creator`"},{"direction":"ASC","expression":"DATE_TRUNC(\"MONTH\", `usage_date`)"}]}}],"spec":{"version":3,"widgetType":"pivot","encodings":{"rows":[{"fieldName":"job_run_creator","displayName":"job_run_creator"}],"columns":[{"fieldName":"monthly(usage_date)","displayName":"usage_date"}],"cell":{"fieldName":"sum(creator_cost)","cellType":"text","displayName":"Sum of creator_cost"}}}},"position":{"x":3,"y":2,"width":3,"height":11}},{"widget":{"name":"d98dd83f","queries":[{"name":"parameter_dashboards/01ef0be9bd371a4fba2b1540082a736d/datasets/01ef0bec4bda1b119a0a18392e898720_from_date","query":{"datasetName":"feb68fe4","parameters":[{"name":"from_date","keyword":"from_date"}],"disaggregated":false}},{"name":"parameter_dashboards/01ef0be9bd371a4fba2b1540082a736d/datasets/01ef0bf07b5513bba433114268be9760_from_date","query":{"datasetName":"b6379e69","parameters":[{"name":"from_date","keyword":"from_date"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"parameterName":"from_date","queryName":"parameter_dashboards/01ef0be9bd371a4fba2b1540082a736d/datasets/01ef0bec4bda1b119a0a18392e898720_from_date"},{"parameterName":"from_date","queryName":"parameter_dashboards/01ef0be9bd371a4fba2b1540082a736d/datasets/01ef0bf07b5513bba433114268be9760_from_date"}]},"frame":{"showTitle":true,"title":"From Date"}}},"position":{"x":0,"y":1,"width":2,"height":1}},{"widget":{"name":"ac9c6cfb","queries":[{"name":"parameter_dashboards/01ef0be9bd371a4fba2b1540082a736d/datasets/01ef0bec4bda1b119a0a18392e898720_to_date","query":{"datasetName":"feb68fe4","parameters":[{"name":"to_date","keyword":"to_date"}],"disaggregated":false}},{"name":"parameter_dashboards/01ef0be9bd371a4fba2b1540082a736d/datasets/01ef0bf07b5513bba433114268be9760_to_date","query":{"datasetName":"b6379e69","parameters":[{"name":"to_date","keyword":"to_date"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"parameterName":"to_date","queryName":"parameter_dashboards/01ef0be9bd371a4fba2b1540082a736d/datasets/01ef0bec4bda1b119a0a18392e898720_to_date"},{"parameterName":"to_date","queryName":"parameter_dashboards/01ef0be9bd371a4fba2b1540082a736d/datasets/01ef0bf07b5513bba433114268be9760_to_date"}]},"frame":{"showTitle":true,"title":"To Date"}}},"position":{"x":2,"y":1,"width":2,"height":1}},{"widget":{"name":"22ac91aa","queries":[{"name":"main_query","query":{"datasetName":"feb68fe4","fields":[{"name":"sum(pct_attribution)","expression":"SUM(`pct_attribution`)"},{"name":"job_run_creator","expression":"`job_run_creator`"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"pie","encodings":{"angle":{"fieldName":"sum(pct_attribution)","scale":{"type":"quantitative"},"displayName":"Sum of pct_attribution"},"color":{"fieldName":"job_run_creator","scale":{"type":"categorical"},"displayName":"job_run_creator"},"label":{"show":true}},"frame":{"showTitle":true,"title":"Job runner apportionment"}}},"position":{"x":0,"y":2,"width":3,"height":5}},{"widget":{"name":"9f80f751","queries":[{"name":"main_query","query":{"datasetName":"feb68fe4","fields":[{"name":"sum(pct_attribution)","expression":"SUM(`pct_attribution`)"},{"name":"job_run_creator","expression":"`job_run_creator`"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"heatmap","encodings":{"y":{"fieldName":"job_run_creator","scale":{"type":"categorical"},"displayName":"job_run_creator"},"color":{"fieldName":"sum(pct_attribution)","scale":{"type":"quantitative"},"displayName":"Sum of pct_attribution"}},"frame":{"showTitle":true,"title":"Job runner apportionment"}}},"position":{"x":0,"y":7,"width":3,"height":6}}]}]}